<!DOCTYPE html>
<html>
<head>
	<title>我最爱的宝宝</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<style>
		html,body {height: 100%;}
		body {background-color: #000000;margin: 0;font-family: Helvetica, sans-serif;overflow: hidden;}
		a {color: #ffffff;}
		#info {position: absolute;width: 100%;color: #ffffff;padding: 5px;font-family: Monospace;font-size: 13px;font-weight: bold;text-align: center;z-index: 1;}
		#menu {position: absolute;bottom: 20px;width: 100%;text-align: center;}
		.element {width: 100px;height: 100px;box-shadow: 0px 0px 12px rgba(0, 255, 255, 0.5);border: 1px solid rgba(127, 255, 255, 0.25);text-align: center;cursor: default;}
		.element:hover {box-shadow: 0px 0px 12px rgba(0, 255, 255, 0.75);border: 1px solid rgba(127, 255, 255, 0.75);}
		.element img {
			width: 100%;
			height: 100%;
			object-fit: cover; /* 保持比例，不拉伸 */
		}
		button {color: rgba(127, 255, 255, 0.75);background: transparent;outline: 1px solid rgba(127, 255, 255, 0.75);border: 0px;padding: 5px 10px;cursor: pointer;}
		button:hover {background-color: rgba(0, 255, 255, 0.5);}
		button:active {color: #000000;background-color: rgba(0, 255, 255, 0.75);}
		.show_info {position: fixed;background-color: rgba(0, 0, 0, .6);padding: 10px;width: 300px;margin: 0 auto;left: 0;right: 0;border-radius: 5px;box-shadow: 0 0 10px 0 #fff;top: 30%;display: none;z-index: 9999;}
		.show_info img {display: block;margin: auto;border-radius: 5px;box-shadow: 0 0 10px 0 #888;}
		/* 隐藏图片库 */
		.img-library {display: none;}
	</style>
	<link rel="stylesheet" href="css/animate.min.css">
</head>
<body>
	<script src="js/jquery.min.js"></script>
	<script src="js/three.js"></script>
	<script src="js/tween.min.js"></script>
	<script src="js/TrackballControls.js"></script>
	<script src="js/CSS3DRenderer.js"></script>

	<audio id="bgmusic" src="henry.mp3" autoplay="autoplay" loop="loop" style="display: block; width: 3%; height:3%;"></audio>

	<div id="container"></div>
	<div id="menu">
		<button id="table">表格</button>
		<button id="sphere">球球</button>
		<button id="helix">螺旋</button>
		<button id="grid">格子</button>
	</div>

	<!-- 1. 隐藏图片库：手动添加所有图片（新增图片时，只需要在这里加一行） -->
	<div class="img-library">
		<!-- 原有图片 -->
	    <img id="img-1" src="img/1.jpg" alt="">
        <img id="img-2" src="img/2.jpg" alt="">
        <img id="img-3" src="img/3.jpg" alt="">
        <img id="img-4" src="img/4.jpg" alt="">
        <img id="img-5" src="img/5.jpg" alt="">
        <img id="img-6" src="img/6.jpg" alt="">
        <img id="img-7" src="img/7.jpg" alt="">
        <img id="img-8" src="img/8.jpg" alt="">
        <img id="img-9" src="img/9.jpg" alt="">
        <img id="img-10" src="img/10.jpg" alt="">
        <img id="img-11" src="img/11.jpg" alt="">
        <img id="img-12" src="img/12.jpg" alt="">
        <img id="img-13" src="img/13.jpg" alt="">
        <img id="img-14" src="img/14.jpg" alt="">
        <img id="img-15" src="img/15.jpg" alt="">
        <img id="img-16" src="img/16.jpg" alt="">
        <img id="img-17" src="img/17.jpg" alt="">
        <img id="img-18" src="img/18.jpg" alt="">
        <img id="img-19" src="img/19.jpg" alt="">
        <img id="img-20" src="img/20.jpg" alt="">
        <img id="img-21" src="img/21.jpg" alt="">
        <img id="img-22" src="img/22.jpg" alt="">
        <img id="img-23" src="img/23.jpg" alt="">
        <img id="img-24" src="img/24.jpg" alt="">
        <img id="img-25" src="img/25.jpg" alt="">

	</div>

	<!-- 2. 展示区域 -->
	<div class="show_info animated">
		<div class="info_my">
			<div id="show-img-container"></div>
		</div>
	</div>

	<script>

		window.onload = function() {
    const audio = document.getElementById('bgmusic');
    
    // 尝试自动播放（静音状态下浏览器允许）
    audio.play().catch(err => {
        console.log('自动播放失败，等待用户交互:', err);
    });

    // 监听页面任意点击，解锁声音
    document.addEventListener('click', function() {
        audio.muted = false; // 取消静音
        audio.volume = 0.8; // 设置音量（0-1，0.8=80%）
        audio.play(); // 确保播放
    }, { once: true }); // 只触发一次，避免重复解锁
};
		// animate动画数组
		var _in = ['bounceIn', 'bounceInDown', 'bounceInLeft', 'bounceInRight', 'bounceInUp', 'fadeIn', 'fadeInDown', 'fadeInDownBig', 'fadeInLeft', 'fadeInLeftBig', 'fadeInRight', 'fadeInRightBig', 'fadeInUp', 'fadeInUpBig', 'rotateIn', 'rotateInDownLeft', 'rotateInDownRight', 'rotateInUpLeft', 'rotateInUpRight', 'slideInDown', 'slideInLeft', 'slideInRight'];
		var _out = ['bounceOut', 'bounceOutDown', 'bounceOutLeft', 'bounceOutRight', 'bounceOutUp', 'fadeOut', 'fadeOutDown', 'fadeOutDownBig', 'fadeOutLeft', 'fadeOutLeftBig', 'fadeOutRight', 'fadeOutRightBig', 'fadeOutUp', 'fadeOutUpBig', 'rotateOut', 'rotateOutDownLeft', 'rotateOutDownRight', 'rotateOutUpLeft', 'rotateOutUpRight', 'slideOutDown', 'slideOutLeft', 'slideOutRight'];

		// 2. 自动读取所有图片（不用手动改数组）
		var allImgs = $('.img-library img'); // 获取所有图片节点
		var personArray = []; // 存储图片信息的数组
		allImgs.each(function(index, el) {
			personArray.push({
				imgNode: el, // 图片节点
				imgSrc: $(el).attr('src') // 图片路径
			});
		});

		// 3. 随机展示逻辑（自动适配所有图片）
		var s = setInterval(function () {
			// 随机选入场/出场动画
			var rand_in = parseInt(Math.random() * _in.length, 10);
			var rand_out = parseInt(Math.random() * _out.length, 10);
			
			// 随机选一张图片（自动适配数组长度，不会越界）
			var randomIndex = Math.floor(Math.random() * personArray.length);
			var randomImg = personArray[randomIndex].imgNode;
			
			// 清空展示容器，克隆图片并显示
			$('#show-img-container').empty();
			var cloneImg = $(randomImg).clone(); // 克隆图片节点
			cloneImg.attr('width', '220px'); // 设置展示尺寸
			cloneImg.attr('height', '220px'); // 设置展示尺寸
			$('#show-img-container').append(cloneImg);

			

			// 动画逻辑
			$('.show_info').show().addClass(_in[rand_in]);
			setTimeout(function () {
				$('.show_info').removeClass(_in[rand_in]);
				setTimeout(function () {
					$('.show_info').addClass(_out[rand_out]);
					setTimeout(function () {
						$('.show_info').removeClass(_out[rand_out]).hide();
					}, 1000);
				}, 1500);
			}, 1000);
		}, 4500);

		// 4. 3D场景初始化（自动适配所有图片）
		var table = [];
		allImgs.each(function(index, el) {
			table.push({
				imgNode: el,
				p_x: index % 20 + 1,
				p_y: Math.floor(index / 20) + 1
			});
		});

		var camera, scene, renderer;
		var controls;
		var objects = [];
		var targets = { table: [], sphere: [], helix: [], grid: [] };

		init();
		animate();

		function init() {
			// 相机初始化
			camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 10000);
			camera.position.z = 3000;
			scene = new THREE.Scene();

			// 生成3D元素（自动适配所有图片）
			for (var i = 0; i < table.length; i++) {
				var element = document.createElement('div');
				element.className = 'element';
				element.style.backgroundColor = 'rgba(0,127,127,' + (Math.random() * 0.5 + 0.25) + ')';

				// 克隆图片到3D元素
				var img = $(table[i].imgNode).clone()[0];
				img.style.width = '100%';
				img.style.height = '100%';
				img.style.objectFit = 'cover';
				element.appendChild(img);

				var object = new THREE.CSS3DObject(element);
				object.position.x = Math.random() * 4000 - 2000;
				object.position.y = Math.random() * 4000 - 2000;
				object.position.z = Math.random() * 4000 - 2000;
				scene.add(object);
				objects.push(object);

				// 表格布局坐标
				var targetObj = new THREE.Object3D();
				targetObj.position.x = (table[i].p_x * 140) - 1330;
				targetObj.position.y = - (table[i].p_y * 180) + 990;
				targets.table.push(targetObj);
			}

			// 球体布局
			var vector = new THREE.Vector3();
			var spherical = new THREE.Spherical();
			for (var i = 0, l = objects.length; i < l; i++) {
				var phi = Math.acos(-1 + (2 * i) / l);
				var theta = Math.sqrt(l * Math.PI) * phi;
				var object = new THREE.Object3D();
				spherical.set(800, phi, theta);
				object.position.setFromSpherical(spherical);
				vector.copy(object.position).multiplyScalar(2);
				object.lookAt(vector);
				targets.sphere.push(object);
			}

			// 螺旋布局
			var cylindrical = new THREE.Cylindrical();
			for (var i = 0, l = objects.length; i < l; i++) {
				var theta = i * 0.175 + Math.PI;
				var y = - (i * 5) + 450;
				var object = new THREE.Object3D();
				cylindrical.set(900, theta, y);
				object.position.setFromCylindrical(cylindrical);
				vector.x = object.position.x * 2;
				vector.y = object.position.y;
				vector.z = object.position.z * 2;
				object.lookAt(vector);
				targets.helix.push(object);
			}

			// 网格布局
			for (var i = 0; i < objects.length; i++) {
				var object = new THREE.Object3D();
				object.position.x = ((i % 5) * 400) - 800;
				object.position.y = (- (Math.floor(i / 5) % 5) * 300) + 500;
				object.position.z = (Math.floor(i / 25)) * 200 - 800;
				targets.grid.push(object);
			}

			// 渲染器
			renderer = new THREE.CSS3DRenderer();
			renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.domElement.style.position = 'absolute';
			document.getElementById('container').appendChild(renderer.domElement);

			// 鼠标控制
			controls = new THREE.TrackballControls(camera, renderer.domElement);
			controls.rotateSpeed = 0.5;
			controls.minDistance = 500;
			controls.maxDistance = 6000;
			controls.addEventListener('change', render);

			// 自动切换布局
			var ini = 0;
			setInterval(function () {
				ini = ini >= 3 ? 0 : ini;
				++ini;
				switch (ini) {
					case 1: transform(targets.sphere, 1000); break;
					case 2: transform(targets.helix, 1000); break;
					case 3: transform(targets.grid, 1000); break;
				}
			}, 8000);

			// 按钮点击事件
			document.getElementById('table').addEventListener('click', function () { transform(targets.table, 1000); }, false);
			document.getElementById('sphere').addEventListener('click', function () { transform(targets.sphere, 2000); }, false);
			document.getElementById('helix').addEventListener('click', function () { transform(targets.helix, 2000); }, false);
			document.getElementById('grid').addEventListener('click', function () { transform(targets.grid, 2000); }, false);

			// 初始布局
			transform(targets.table, 2000);
			window.addEventListener('resize', onWindowResize, false);
		}

		// 布局切换动画
		function transform(targets, duration) {
			TWEEN.removeAll();
			for (var i = 0; i < objects.length; i++) {
				var object = objects[i];
				var target = targets[i];
				new TWEEN.Tween(object.position)
					.to({ x: target.position.x, y: target.position.y, z: target.position.z }, Math.random() * duration + duration)
					.easing(TWEEN.Easing.Exponential.InOut)
					.start();
				new TWEEN.Tween(object.rotation)
					.to({ x: target.rotation.x, y: target.rotation.y, z: target.rotation.z }, Math.random() * duration + duration)
					.easing(TWEEN.Easing.Exponential.InOut)
					.start();
			}
			new TWEEN.Tween(this)
				.to({}, duration * 2)
				.onUpdate(render)
				.start();
		}

		// 窗口大小适配
		function onWindowResize() {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
			render();
		}

		// 动画循环
		function animate() {
			scene.rotation.y += 0.008;
			requestAnimationFrame(animate);
			TWEEN.update();
			controls.update();
			render();
		}

		// 渲染函数
		function render() {
			renderer.render(scene, camera);
		}
	</script>
</body>
</html>